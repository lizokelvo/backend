{% extends "base.html" %}

{% block lab %}–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 9{% endblock %}

{% block script %}
<script>
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å–Ω–µ–∂–∏–Ω–æ–∫
    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        snowflake.innerHTML = '‚ùÑÔ∏è';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = Math.random() * 3 + 2 + 's';
        snowflake.style.fontSize = Math.random() * 20 + 10 + 'px';
        snowflake.style.opacity = Math.random();
        document.body.appendChild(snowflake);

        setTimeout(() => {
            snowflake.remove();
        }, 5000);
    }

    // –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏ –∫–∞–∂–¥—ã–µ 300–º—Å
    setInterval(createSnowflake, 300);
</script>
{% endblock %}

{% block main %}
<style>
    body {
        background: linear-gradient(to bottom, #0b3d2c, #1a5c45);
        font-family: 'Arial', sans-serif;
        color: white;
        margin: 0;
        padding: 20px;
        text-align: center;
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
    }

    .header {
        background-color: #c62828;
        padding: 30px;
        border-radius: 15px;
        margin-bottom: 30px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        border: 2px solid #ffd700;
    }

    .header h1 {
        font-size: 48px;
        margin: 0 0 10px 0;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .header p {
        font-size: 20px;
        margin: 0;
        color: #ffd700;
    }

    .counter {
        font-size: 24px;
        margin: 20px auto;
        padding: 15px 30px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50px;
        display: inline-block;
        border: 2px solid #ffd700;
        backdrop-filter: blur(5px);
    }

    .gift-container {
        position: relative;
        min-height: 500px;
        margin: 20px auto;
        max-width: 800px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
        padding: 20px;
    }

    .gift-box {
        position: absolute;
        width: 80px;
        height: 80px;
        cursor: pointer;
        transition: transform 0.3s, opacity 0.3s;
        background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="80" height="80" x="10" y="10" fill="%23c62828" rx="10"/><rect width="60" height="20" x="20" y="0" fill="%23ffd700" rx="5"/><rect width="20" height="60" x="40" y="20" fill="%23ffd700" rx="5"/><circle cx="50" cy="30" r="5" fill="%23ffffff"/></svg>');
        background-size: cover;
        filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
    }

    .gift-box:hover {
        transform: scale(1.1) translateY(-5px);
        filter: drop-shadow(0 10px 20px rgba(255,215,0,0.3));
    }

    .gift-box.opened {
        opacity: 0.5;
        cursor: default;
        filter: grayscale(0.5);
    }

    .gift-box.opened:hover {
        transform: none;
    }

    .snowflake {
        position: fixed;
        top: -10px;
        color: white;
        font-size: 1em;
        pointer-events: none;
        z-index: 999;
        animation: fall linear forwards;
        user-select: none;
    }

    @keyframes fall {
        to {
            transform: translateY(100vh);
        }
    }

    .message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        color: #333;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        z-index: 1000;
        max-width: 400px;
        text-align: center;
        border: 3px solid #ffd700;
        display: none;
    }

    .message.show {
        display: block;
        animation: pop 0.3s ease-out;
    }

    @keyframes pop {
        0% { transform: translate(-50%, -50%) scale(0); }
        80% { transform: translate(-50%, -50%) scale(1.1); }
        100% { transform: translate(-50%, -50%) scale(1); }
    }

    .message button {
        margin-top: 20px;
        padding: 10px 30px;
        background: #c62828;
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-size: 16px;
    }

    .message button:hover {
        background: #b71c1c;
    }

    .remaining {
        font-weight: bold;
        color: #ffd700;
        font-size: 32px;
    }
</style>

<div class="header">
    <h1>üéÑ –° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! üéÑ</h1>
    <p>–û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ 3 –ø–æ–¥–∞—Ä–∫–æ–≤! –£–¥–∞—á–∏!</p>
</div>

<div class="counter">
    –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: <span id="remainingCount" class="remaining">3</span>
</div>

<div class="gift-container" id="giftContainer"></div>

<div class="message" id="message">
    <h2 id="messageTitle">üéÅ –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ!</h2>
    <p id="messageText"></p>
    <button onclick="closeMessage()">–û–ö</button>
</div>

<script>
    let remainingAttempts = 3;
    const giftContainer = document.getElementById('giftContainer');
    const remainingSpan = document.getElementById('remainingCount');
    const messageDiv = document.getElementById('message');
    const messageText = document.getElementById('messageText');
    const messageTitle = document.getElementById('messageTitle');

    // –ü–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥–∞—Ä–∫–∞
    const greetings = [
        "–°—á–∞—Å—Ç—å—è, –∑–¥–æ—Ä–æ–≤—å—è –∏ —É–¥–∞—á–∏ –≤ –Ω–æ–≤–æ–º –≥–æ–¥—É!",
        "–ü—É—Å—Ç—å –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–∞–º—ã–µ –∑–∞–≤–µ—Ç–Ω—ã–µ –º–µ—á—Ç—ã!",
        "–ú–æ—Ä–µ —É–ª—ã–±–æ–∫, —Ç–µ–ø–ª–∞ –∏ –ø–æ–∑–∏—Ç–∏–≤–∞!",
        "–£—Å–ø–µ—Ö–æ–≤ –≤–æ –≤—Å–µ—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏—è—Ö!",
        "–Ø—Ä–∫–∏—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–π –∏ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤!",
        "–ü—É—Å—Ç—å –¥–æ–º –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ–π —á–∞—à–µ–π!",
        "–¢–µ–ø–ª–∞, —É—é—Ç–∞ –∏ –≥–∞—Ä–º–æ–Ω–∏–∏!",
        "–ù–æ–≤—ã—Ö –ø–æ–±–µ–¥ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π!",
        "–õ—é–±–≤–∏, —Ä–∞–¥–æ—Å—Ç–∏ –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è!",
        "–ü—É—Å—Ç—å –≤—Å—ë –∑–∞–¥—É–º–∞–Ω–Ω–æ–µ —Å–±—É–¥–µ—Ç—Å—è!"
    ];

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–æ–≤ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –ø–æ–∑–∏—Ü–∏—è–º–∏
    for (let i = 0; i < 10; i++) {
        const gift = document.createElement('div');
        gift.className = 'gift-box';
        gift.dataset.index = i;
        gift.dataset.opened = 'false';
        
        // –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏
        const left = Math.random() * 80 + 5; // 5% - 85%
        const top = Math.random() * 70 + 5;  // 5% - 75%
        
        gift.style.left = left + '%';
        gift.style.top = top + '%';
        
        gift.onclick = function() {
            if (this.dataset.opened === 'true') return;
            
            if (remainingAttempts <= 0) {
                alert('–í—ã —É–∂–µ –æ—Ç–∫—Ä—ã–ª–∏ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏!');
                return;
            }
            
            remainingAttempts--;
            remainingSpan.textContent = remainingAttempts;
            
            this.dataset.opened = 'true';
            this.classList.add('opened');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ
            const index = parseInt(this.dataset.index);
            messageText.textContent = greetings[index % greetings.length];
            messageDiv.classList.add('show');
        };
        
        giftContainer.appendChild(gift);
    }

    function closeMessage() {
        messageDiv.classList.remove('show');
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤—Å–µ –ª–∏ –ø–æ–¥–∞—Ä–∫–∏ –æ—Ç–∫—Ä—ã—Ç—ã
    function checkAllOpened() {
        const gifts = document.querySelectorAll('.gift-box');
        let opened = 0;
        gifts.forEach(gift => {
            if (gift.dataset.opened === 'true') opened++;
        });
        if (opened === 10) {
            setTimeout(() => {
                alert('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –æ—Ç–∫—Ä—ã–ª–∏ –≤—Å–µ –ø–æ–¥–∞—Ä–∫–∏! –° –ù–æ–≤—ã–º –ì–æ–¥–æ–º! üéâ');
            }, 500);
        }
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è
    const originalGiftClick = document.querySelector('.gift-box')?.onclick;
</script>
{% endblock %}